背景
一个典型的 GreptimeDB 集群模式部署如下图所示：
/Users/admin/Desktop/截屏2025-08-22 10.01.22.png
暂时无法在飞书文档外展示此内容
其依赖顺序依次为元数据存储（etcd 或 RDS）、metasrv、对象存储（OSS、S3 或 MinIO 等）、datanode、frontend。在真实用户部署的环境下，可能由于配置、环境等各种原因导致依赖有问题而无法正确启动集群，需要付出极大的精力帮助用户排查。常见的错误有：
- 对象存储的 AK/SK 错误或者无操作权限
- etcd/RDS 配置错误或无法访问
- Datanode/Frontend 的地址配置（如 listen port）错误导致用户无法访问对应协议的端口
- 磁盘性能无法满足需求导致写入吞吐受限

因此我们需要一款工具能够在用户指定配置之后根据用户的配置检查是否能够正确地启动集群。

需求详情
集群自检工具的交付形态应该是一个二进制命令行工具，其最基础的能力集合是根据用户即将使用的配置文件去检查集群所需要的资源和权限是否就绪。如：
# Check metasrv config
greptime-self-test metasrv -c metasrv_config.conf

# Check frontend config
greptime-self-test frontend -c frontend_config.toml

# Check datanode config
greptime-self-test datanode -c datanode_config.toml
而具体到每个命令所检查的具体内容，我们可以从一个最小功能集入手：
- 对于 metasrv，检查所指定的 etcd 或 RDS 是否能够正常访问并读写
  - 对于 etcd，GreptimeDB 需要其能够支持 put/get/delete 等基础的 KV 操作能力
  - 对于 RDS，如 PostgreSQL，需要检查配置文件所指定的表（meta_table_name）是否存在、是否有读写权限等
- 对于 Frontend，检查配置文件中的 metasrv （配置文件中的 metasrv_addrs）是否能够正常访问
- 对于 Datanode，检查：
  - 配置文件中的 metasrv （配置文件中的 metasrv_addrs）是否能够正常访问
  - 配置文件中的对象存储是否能够正常访问，比如 bucket 是否存在、指定的 AKSK 是否能够读写这些 bucket
  - 进一步地，可以尝试测试这些对象存储的读写性能如何（吞吐、延迟）

完成以上需求后，可以根据用户真实场景下的部署所遇到的问题去增加新的自检项。

前置知识
- GreptimeDB 集群模式的基础部署模式，尝试在本地或者 Greptime 提供的 Kubernetes 集群中部署一个简单的 GreptimeDB 集群。参考文档：GreptimeDB Cluster
- Rust 基础知识以及使用 Rust 构建命令行工具的常用 crate，参考：
  - https://docs.rs/clap/latest/clap/
  - Writing a CLI Tool in Rust with Clap
- 对应组件的 Rust Crate
  - etcd：https://docs.rs/etcd-client/latest/etcd_client/
  - SQL（包含 PostgreSQL 和 MySQL）：https://docs.rs/sqlx/latest/sqlx/
  - OpenDAL（用于操作对象存储）：https://github.com/apache/OpenDAL
  - toml（用于解析 toml 配置文件）：https://docs.rs/toml/latest/toml/
- Github 基础操作
  - 代码仓库：https://github.com/GreptimeTeam/stepstone



